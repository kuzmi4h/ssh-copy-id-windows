# ssh-copy-id для Windows

Нативная версия утилиты `ssh-copy-id` из Linux для Windows, написанная на языке C.

## Описание

Копирует публичный SSH ключ на удалённый сервер и добавляет его в файл `~/.ssh/authorized_keys` для аутентификации без пароля.

## Требования

- Windows 10/11 или Windows Server 2016+
- OpenSSH клиент (встроен в Windows 10 1809+)

## Установка

### Быстрый старт

1. Скачайте `ssh-copy-id.exe` в любую директорию
2. Добавьте директорию в `PATH` или используйте полный путь

### Проверка OpenSSH

```cmd
where ssh
```

Если не найден, установите:

```cmd
# Windows 10/11 (через настройки)
# Параметры → Приложения → Дополнительные компоненты → Добавить компонент → OpenSSH клиент
```

Или через PowerShell (от имени администратора):

```powershell
Add-WindowsCapability -Online -Name OpenSSH.Client~~~~0.0.1.0
```

### Компиляция из исходников

Если у вас установлен GCC (MinGW):

```cmd
gcc -O2 -Wall -Wextra -o ssh-copy-id.exe ssh-copy-id.c -lws2_32
```

Или используйте скрипт:

```cmd
build.bat
```

## Использование

### Базовый синтаксис

```cmd
ssh-copy-id.exe [опции] [пользователь@]хост
```

### Опции

| Опция | Описание |
|-------|----------|
| `-i <файл>` | Путь к публичному ключу (по умолчанию: `~/.ssh/id_rsa.pub`) |
| `-p <порт>` | Порт SSH (по умолчанию: 22) |
| `-f` | Не проверять наличие ключа, добавить принудительно |
| `-n` | Пробный запуск: показать, что будет сделано |
| `-q` | Тихий режим |
| `-o "<опции>"` | Дополнительные опции SSH |
| `-F <файл>` | Файл конфигурации SSH |
| `-h` | Показать справку |

## Примеры

### Копирование ключа по умолчанию

```cmd
ssh-copy-id.exe user@example.com
```

### С указанием порта

```cmd
ssh-copy-id.exe -p 2222 user@192.168.1.100
```

### С указанием файла ключа

```cmd
ssh-copy-id.exe -i C:\Users\%USERNAME%\.ssh\id_ed25519.pub user@server.local
```

### Принудительное копирование (без проверки)

```cmd
ssh-copy-id.exe -f root@10.0.0.1
```

### С дополнительными SSH опциями

```cmd
ssh-copy-id.exe -o "StrictHostKeyChecking=no" user@host
```

### Пробный запуск (dry-run)

```cmd
ssh-copy-id.exe -n user@host
```

## Генерация SSH ключа

Если у вас ещё нет SSH ключа:

```cmd
ssh-keygen -t ed25519 -C "your_email@example.com"
```

Или RSA:

```cmd
ssh-keygen -t rsa -b 4096 -C "your_email@example.com"
```

## Проверка результата

После копирования проверьте подключение:

```cmd
ssh user@host
```

Подключение должно выполниться без запроса пароля.

## Структура проекта

```
copy-id/
├── ssh-copy-id.exe      # Готовый exe-файл (рекомендуется)
├── ssh-copy-id.c        # Исходный код на C
├── ssh-copy-id.ps1      # PowerShell версия (альтернативная)
├── ssh-copy-id.cmd      # Обёртка для PowerShell версии
├── build.bat            # Скрипт компиляции
├── Makefile             # Makefile для GCC/MSVC
└── README.md            # Документация (English)
└── README.ru.md         # Документация (Русский)
```

## Особенности

- Нативный Windows executable (не требует PowerShell)
- Все основные опции оригинальной Linux утилиты
- Поддержка путей Windows (`C:\Users\...` или `~`)
- Минимальные зависимости (только OpenSSH клиент)
- Английские сообщения (проблем с кодировкой)

## Решение проблем

### "SSH клиент не найден"

Установите OpenSSH клиент через настройки Windows или PowerShell:

```powershell
Add-WindowsCapability -Online -Name OpenSSH.Client~~~~0.0.1.0
```

### "Публичный ключ не найден"

1. Проверьте наличие ключа: `dir %USERPROFILE%\.ssh\id_rsa.pub`
2. Если есть только приватный ключ, создайте публичный:
   ```cmd
   ssh-keygen -y -f %USERPROFILE%\.ssh\id_rsa > %USERPROFILE%\.ssh\id_rsa.pub
   ```

### "Не удалось подключиться к серверу"

- Проверьте доступность сервера: `ping хост`
- Проверьте порт: `telnet хост порт`
- Убедитесь в правильности логина/пароля
- Проверьте настройки брандмауэра

### "Ключ уже присутствует на сервере"

Утилита автоматически проверяет наличие ключа. Если ключ уже есть, повторное добавление не требуется.

Для принудительного добавления используйте опцию `-f`.

## Лицензия

MIT License
